<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Heatmaps</title>
<style>
    html, body, #map-canvas {
    height: 100%;
    margin: 0px;
    padding: 0px
    }
    #panel {
    position: absolute;
    top: 5px;
    left: 50%;
    margin-left: -180px;
    z-index: 5;
    background-color: #fff;
    padding: 5px;
    border: 1px solid #999;
    }
</style>
<script src="https://maps.googleapis.com/maps/api/js"></script>

    <script type="text/javascript" src="//code.jquery.com/jquery-2.1.3.min.js"></script>

    <script>
    // Adding 500 Data Points
    var map, pointArray, heatmap;

    function initialize() {
      var mapOptions = {
        zoom: 2,
        center: new google.maps.LatLng(0, 150),
      };

      map = new google.maps.Map(document.getElementById('map-canvas'),
          mapOptions);

      pointArray = new google.maps.MVCArray();
    }

    google.maps.event.addDomListener(window, 'load', initialize);

    var ws = new WebSocket('ws' +
         (document.location.protocol === 'https:' ? 's' : '') +
         '://' + document.location.hostname + ':' + document.location.port + '/ws');
         
    ws.onmessage = function (evt)
    {
      var response = evt.data;
      (function() {
      var iplookupUrl = "http://freegeoip.net/json/" + response;
      $.getJSON(iplookupUrl)
        .done( function( data ) {
            var latlong = new google.maps.LatLng(data.latitude, data.longitude);
            var marker = new google.maps.Marker({
                position: latlong,
                map: map,
                animation: google.maps.Animation.BOUNCE,
                title: data.city,
                opacity: 1.0
              });
            map.panTo(latlong);
            setTimeout(function () {
              marker.setAnimation(null);
            }, 6000);
            setInterval(function () {
              marker.setOpacity(Math.max(0, marker.getOpacity() - 0.1));
            }, 1000);
            setTimeout(function () {
              marker.setMap(null);
            }, 60000);
          })
    })();
    };

</script>
</head>

<body>
<div id="panel">
</div>
<div id="map-canvas"></div>
</body>
</html>